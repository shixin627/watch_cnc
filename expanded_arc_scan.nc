%
; ========================================
; 2.5D 弧面掃描 - 展開版 (無 WHILE 循環)
; Arc Surface Scanning - Expanded Version
; ========================================
;
; 適用於不支援 WHILE 的 Mach3 版本
; 使用固定步數展開所有路徑
; ========================================

; ========== 參數設定 ==========
#100 = 0.0          ; Xc
#101 = -10.0        ; Zc
#102 = 10.0         ; R0
#110 = 0.0          ; Y0
#111 = 0.4          ; Y1
#122 = 0.5          ; DX (較大步距以減少程式碼量)
#130 = 20           ; 進給速率

G90 G21 G40 G49 G80
F#130

G0 Z5.0
G0 X#100 Y#110

; ========================================
; 第 1 層: Z = -0.1
; ========================================
#201 = -0.1         ; Z_layer
#202 = 9.9          ; R = 10.0 - 0.1

; 計算 X 範圍
#203 = #101 - #201  ; dZ = -10.0 - (-0.1) = -9.9
#204 = #202 * #202 - #203 * #203
#205 = SQRT[#204]   ; X_range
#206 = #100 - #205  ; X_start
#207 = #100 + #205  ; X_end

(MSG, Layer 1: Z=-0.1 R=9.9)

; 路徑 1: Xc → X_start @ Y0
; 手動展開 (範例: 20 步)
#210 = #100
#211 = #210 - #100
#212 = #202 * #202 - #211 * #211
IF [#212 LT 0] THEN #212 = 0
#213 = SQRT[#212]
#214 = #101 - #213
IF [#214 GT #201] THEN #214 = #201
G1 X#210 Y#110 Z#214

#210 = #210 - #122
#211 = #210 - #100
#212 = #202 * #202 - #211 * #211
IF [#212 LT 0] THEN #212 = 0
#213 = SQRT[#212]
#214 = #101 - #213
IF [#214 GT #201] THEN #214 = #201
G1 X#210 Y#110 Z#214

#210 = #210 - #122
#211 = #210 - #100
#212 = #202 * #202 - #211 * #211
IF [#212 LT 0] THEN #212 = 0
#213 = SQRT[#212]
#214 = #101 - #213
IF [#214 GT #201] THEN #214 = #201
G1 X#210 Y#110 Z#214

; ... (重複直到 X_start)
; 此處僅為範例結構，實際需要展開所有步

; 簡化處理: 直接到 X_start
G1 X#206 Y#110

; Y0 → Y1
G1 Y#111

; X_start → X_end @ Y1 (簡化為直線)
G1 X#207 Y#111

; Y1 → Y0
G1 Y#110

; X_end → Xc @ Y0
G1 X#100 Y#110

; ========================================
; 第 2-10 層 (結構相同，僅參數變化)
; ========================================
; 此處省略，實際應重複類似結構
; ...

; 完成
G0 Z5.0
G0 X0 Y0
M30

; ========================================
; 注意:
; 此為簡化範例框架
; 完整版需要展開所有 10 層
; 每層需要展開所有 X 步進點
; 建議使用外部腳本生成完整程式
; ========================================
%
