# STL CAM Tool 使用指南

## 工具簡介

STL CAM Tool 是一個智能化的 CNC 加工路徑生成工具,讓您可以:

1. **載入任意 STL 檔案** - 支援所有標準 STL 格式
2. **視覺化選擇加工區域** - 用立方體框選需要切除的部分
3. **自動生成刀具路徑** - 智能辨識並生成 3D 輪廓銑削路徑
4. **即時預覽路徑** - 在 3D 場景中查看生成的路徑
5. **匯出標準 G-code** - 直接用於 CNC 機器加工

## 核心優勢

相較於傳統 CAM 軟體:

✅ **無需手動定義加工特徵** - 自動辨識切除區域
✅ **直覺的視覺化操作** - 拖曳即可選擇區域
✅ **快速路徑生成** - 秒級生成複雜路徑
✅ **完全免費開源** - 可自由修改擴展
✅ **輕量級應用** - 無需安裝大型 CAD 軟體

## 詳細功能說明

### 1. STL 檔案載入

**支援格式:**
- Binary STL (常見格式,檔案較小)
- ASCII STL (文字格式,易於編輯)

**載入步驟:**
1. 點擊「載入 STL 檔案」
2. 選擇 .stl 檔案
3. 系統自動解析並顯示模型

**顯示資訊:**
- 檔案名稱
- 三角面數量
- 模型尺寸 (X × Y × Z)

### 2. 3D 視覺化

**視角控制:**
- **左鍵拖曳**: 環繞模型旋轉
- **右鍵拖曳**: 平移視角
- **滾輪**: 縮放視圖
- **重置視角**: 一鍵回到最佳視角

**視覺輔助:**
- 座標軸顯示 (紅=X, 綠=Y, 藍=Z)
- 網格地板
- 多光源照明系統

### 3. 區域選擇工具

**啟用選擇模式:**
1. 點擊「啟用選擇模式」
2. 滑鼠變為十字準星
3. 視角控制暫時停用

**選擇操作:**
1. 在模型表面按住左鍵並拖曳
2. 綠色框線顯示選擇範圍
3. 釋放滑鼠完成選擇

**選擇資訊顯示:**
- 狀態: 已選擇/未選擇
- 區域尺寸 (X × Y × Z)
- 預估體積 (mm³)

**修改選擇:**
- 點擊「清除選擇」重新選擇
- 重新拖曳會建立新選擇框

### 4. 加工參數設定

#### 刀具直徑 (Tool Diameter)
- **預設值**: 1.0 mm
- **範圍**: 0.1 mm - 無限制
- **說明**: 您使用的銑刀直徑,影響路徑間距

#### 步距比例 (Stepover)
- **預設值**: 40%
- **範圍**: 10% - 80%
- **說明**: 相鄰路徑的重疊比例
  - 40% = 每次移動刀具直徑的 40%
  - 數值越小,加工越細緻但時間越長

#### 每層深度 (Stepdown)
- **預設值**: 0.5 mm
- **範圍**: 0.1 mm - 無限制
- **說明**: Z 軸每次下刀的深度
  - 材料越硬,應設定越小
  - 刀具越細,應設定越小

#### 進給速度 (Feed Rate)
- **預設值**: 100 mm/min
- **範圍**: 10 - 無限制
- **說明**: 切削時的移動速度
  - 依材料和刀具調整
  - 過快可能導致斷刀

#### 安全高度 (Safe Z)
- **預設值**: 5.0 mm
- **範圍**: 0 - 無限制
- **說明**: 快速移動時的安全高度
  - 確保刀具不會碰到夾具

### 5. 路徑生成引擎

**演算法原理:**
1. **Z 軸分層**: 依據 stepdown 將選擇區域分成多層
2. **平面掃描**: 在每一層進行 XY 平面掃描
3. **表面檢測**: 使用 Raycasting 找到表面交點
4. **路徑優化**: 採用 Zigzag 模式減少空程

**生成過程:**
1. 點擊「生成刀具路徑」
2. 進度條顯示當前進度
3. 生成完成後顯示:
   - 路徑點數
   - 預估加工時間

**路徑特性:**
- **3D 輪廓銑削**: 沿著表面高度變化切削
- **Zigzag 模式**: 減少抬刀次數
- **自動避讓**: 只在選擇區域內生成路徑

### 6. 路徑預覽

**視覺化顯示:**
- 紅色線條表示刀具路徑
- 可與模型一起旋轉查看
- 即時更新

**檢查要點:**
- 路徑是否覆蓋所有需要加工的區域
- 是否有異常的跳躍或空程
- Z 軸高度變化是否合理

### 7. G-code 匯出

**匯出格式:**
- 標準 G-code (ISO 6983)
- 副檔名: .nc 或 .gcode

**G-code 內容:**
```gcode
; ========== INITIALIZATION ==========
G90                 ; 絕對座標
G21                 ; 公制單位
G40 G49 G80         ; 取消偏移
F100                ; 設定進給速度

; ========== MACHINING ==========
G0 Z5.000           ; 安全高度
G0 X10.000 Y20.000  ; 移動到起點
G1 Z-0.500          ; 下刀
G1 X10.200 Y20.000  ; 切削移動
...

; ========== END ==========
G0 Z5.000           ; 最終抬刀
M30                 ; 程式結束
```

**匯出步驟:**
1. 點擊「匯出 G-code」
2. 選擇儲存位置和檔名
3. 預設檔名: [原檔名]_output.nc

## 使用技巧

### 最佳實踐

1. **選擇區域大小**
   - 不要選擇過大區域,會導致生成時間過長
   - 可分多次選擇和加工

2. **參數調整順序**
   - 先設定刀具直徑(最重要)
   - 再調整步距和深度
   - 最後調整速度

3. **路徑優化**
   - 步距 40-50% 是最佳平衡
   - 深度不要超過刀具直徑的一半

### 常見問題

**Q: 路徑生成很慢?**
A: 可能原因:
- 選擇區域太大
- 步距設定太小
- STL 模型三角面太多

解決方法:
- 縮小選擇區域
- 增大步距比例(如 50%)
- 簡化 STL 模型

**Q: 路徑看起來不平滑?**
A: 這是正常的,G-code 是由許多短直線組成,實際加工時 CNC 控制器會進行平滑處理。

**Q: 如何選擇多個不連續的區域?**
A: 目前版本只支援單一立方體選擇,可以:
- 分多次操作,每次選擇一個區域
- 或選擇包含所有區域的大框(會多切一些)

**Q: 支援哪些 CNC 機器?**
A: 只要支援標準 G-code (G0, G1) 的 3 軸 CNC 機器都可以使用。

## 工作流程範例

### 範例: 加工手錶外殼凹槽

1. **準備 STL 檔案**
   - 在 CAD 軟體中設計手錶外殼
   - 匯出為 .stl 格式

2. **載入並檢視**
   - 載入 STL 檔案
   - 確認模型方向正確

3. **選擇凹槽區域**
   - 啟用選擇模式
   - 在凹槽位置拖曳選擇框
   - 確認選擇範圍包含整個凹槽

4. **設定參數**
   - 刀具直徑: 1.0 mm (使用 1mm 立銑刀)
   - 步距: 40%
   - 每層深度: 0.1 mm (手錶外殼材料較硬)
   - 進給速度: 20 mm/min (精細加工)

5. **生成路徑**
   - 點擊生成
   - 檢查預估時間
   - 查看路徑預覽

6. **匯出 G-code**
   - 匯出為 watch_shell_output.nc
   - 傳送到 CNC 機器
   - 開始加工!

## 進階用法

### 與 Python 腳本整合

您可以結合現有的 [generate_gcode_v2.py](../generate_gcode_v2.py):

1. 使用 STL CAM Tool 快速預覽和選擇
2. 記錄選擇的座標範圍
3. 在 Python 腳本中使用精確的數學計算
4. 兩者結果互相驗證

### 自訂擴展

專案採用模組化設計,容易擴展:

- **新增加工策略**: 修改 `toolpath-generator.js`
- **支援其他格式**: 擴展 `stl-loader.js`
- **客製化 G-code**: 修改 `gcode-exporter.js`
- **UI 調整**: 編輯 `styles.css` 和 `index.html`

## 效能建議

### 硬體需求

- **最低配置**:
  - CPU: 雙核 2GHz
  - RAM: 4GB
  - 顯卡: 支援 WebGL

- **推薦配置**:
  - CPU: 四核 3GHz+
  - RAM: 8GB+
  - 顯卡: 獨立顯卡

### 優化建議

1. **大型 STL 檔案**:
   - 在 CAD 軟體中簡化網格
   - 減少三角面數量到 10 萬以下

2. **記憶體使用**:
   - 一次只載入一個模型
   - 生成完路徑後可關閉重啟

3. **生成速度**:
   - 選擇區域越小越快
   - 步距越大越快

## 下一步

熟悉基本操作後,您可以:

1. 嘗試不同的加工參數組合
2. 處理更複雜的 STL 模型
3. 整合到您的 CNC 工作流程
4. 貢獻代碼或提出改進建議

祝您加工順利! 🔧
